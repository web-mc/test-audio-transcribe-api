# Работа с базой данных

## Обзор

Приложение использует PostgreSQL в качестве основной базы данных для хранения метаданных транскрибаций. Взаимодействие с базой данных осуществляется через SQLAlchemy с использованием асинхронных операций.

## Технологии

- **База данных**: PostgreSQL 17
- **ORM**: SQLAlchemy 2.0+ с asyncpg драйвером
- **Миграции**: Alembic
- **Паттерн**: Repository pattern с базовым SQLAlchemy репозиторием

## Структура базы данных

### Таблица `transcriptions`

| Поле | Тип | Описание | Nullable |
|------|-----|----------|----------|
| `id` | INTEGER | Первичный ключ, автоинкремент | Нет |
| `file_path` | TEXT | Путь к аудиофайлу в хранилище | Нет |
| `transcription` | TEXT | Текст транскрибации | Да |
| `created_at` | TIMESTAMP WITH TIME ZONE | Время создания записи | Нет |

**Индексы:**
- Первичный ключ на поле `id`
- Автоматический индекс на `created_at` (server_default)

## Взаимодействие с базой данных

### Репозиторий (Repository Pattern)

Приложение использует паттерн Repository для абстрагирования доступа к данным:

#### AbstractRepository
Базовый абстрактный класс, определяющий интерфейс для всех репозиториев.

#### SQLAlchemyRepository
Конкретная реализация репозитория на базе SQLAlchemy:

- **add_one(data: dict) -> int**: Добавление новой записи, возвращает ID
- **find_one(\*\*filter_by) -> Any | None**: Поиск одной записи по фильтру
- **delete_one(\*\*filter_by) -> int | None**: Удаление записи, возвращает ID
- **update_one(id: int, data: dict) -> None**: Обновление записи по ID

#### TranscriptionsRepo
Специализированный репозиторий для работы с транскрибациями, наследуется от SQLAlchemyRepository.


См. также: [Настройки приложения](app-settings.md), [Запуск в Docker](docker-setup.md)
